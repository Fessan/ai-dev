# Инструкции для ИИ

**Точка входа** для Claude Code, Codex CLI и других ИИ-инструментов.

## Обязательный порядок перед началом работы

1. **Прочитай этот файл полностью**
2. **Уточни путь к проекту** (из сообщения пользователя)
3. **Посмотри структуру репозитория**: `ls -la` (и при необходимости `find` на 2–3 уровня)
4. **Прочитай guides** из `.claude/guides/`:
   - `project.md` - что и зачем
   - `architecture.md` - как устроено
   - `features.md` - список фич
   - `patterns.md` - стандарты кода
   - `business-rules.md` - бизнес-логика
5. **Найди "источники истины"** о стеке/запуске/тестах/линте по существующим файлам:
   - Python: `pyproject.toml`, `requirements.txt`, `setup.py`
   - Node.js: `package.json`
   - Другие: читай конфиги проекта

## Запрещено

- ❌ **Предполагать технологии/структуру без чтения файлов**
- ❌ **Использовать информацию из других проектов**
- ❌ **Выдумывать команды запуска/тестов/деплоя, если их нет в файлах**
- ❌ **Делать выводы о проекте без чтения реальных файлов репозитория**

## Правило: Если данных не хватает

**Задай вопросы и дождись ответов пользователя.**

## Порядок работы (обязателен)

### 1) Сначала вопросы
- Если есть неопределённости — **задай вопросы и дождись ответов пользователя**

### 2) Затем мини-план (5–9 пунктов)
- Перечисли файлы/папки, которые будут затронуты
- **ОБЯЗАТЕЛЬНО отдельным пунктом**: «Проверка / как убедимся, что работает»

### 3) Жди явного апрува
- Только после **явного апрува** пользователя в чате ты можешь менять файлы/код
- **Исключения**: автообновление guides и команды `/init-project` и `/brainstorm` допускаются без апрува

### 4) Если есть развилка
- Предложи 2–3 варианта
- Пометь один как рекомендованный (кратко почему)
- Дождись выбора пользователя

### 5) Ссылки на файлы
- В ответах ссылайся на **конкретные пути файлов** (что и где смотреть/менять)
- Формат: `path/to/file.py:123` (путь:строка)

## Implementation Checklist (обязателен перед любыми изменениями)

Перед тем как просить апрув на изменения в файлах, ты **обязан** включить в ответ этот чек-лист и отметить пункты:

- [ ] **PRD** для фичи создан/обновлён в `docs/plans.md` (если PRD нет — сначала вопросы и стоп)
- [ ] **Прочитаны** релевантные файлы репозитория (перечислить пути)
- [ ] **Неопределённости закрыты**: вопросы заданы, ответы получены
- [ ] **Мини-план** (5–9 пунктов) подготовлен, с перечислением затрагиваемых файлов
- [ ] **Есть пункт** «Проверка / как убедимся, что работает»

**Правило:**
Пока чек-лист не выполнен и пользователь не дал явный апрув в чате — **никаких изменений файлов**,
**кроме автообновления guides** и выполнения `/init-project` и `/brainstorm`
(они допускаются без апрува).

## TDD обязателен

**Всегда**: тест → код (RED-GREEN-REFACTOR)

1. Пишешь **падающий тест**
2. Запускаешь тест — **убеждаешься что падает**
3. Пишешь **минимальный код** для прохождения теста
4. Запускаешь тест — **убеждаешься что проходит**
5. Рефакторинг (если нужен)
6. Коммит

**Никогда не пиши код без тестов.**

## Guides (источник истины о проекте)

Храни актуальную информацию в `.claude/guides/`:

- `project.md` — что делаем, зачем, кто пользователь
- `architecture.md` — стек, структура, зависимости
- `features.md` — список фич
- `patterns.md` — стандарты кода, тестирование
- `business-rules.md` — бизнес-логика

### Автообновление guides

**Guides обновляются автоматически** после значимых действий (без апрува и без чек-листа):

- Добавлена зависимость → обнови `architecture.md`
- Создана фича → обнови `features.md`
- Настроен CI/CD → обнови `architecture.md`
- Принято архитектурное решение → добавь в `DECISIONS.md`
- Изменены паттерны кода → обнови `patterns.md`
- Добавлено бизнес-правило → обнови `business-rules.md`

**После обновления guides** - кратко сообщи пользователю что обновил.

## Структура work/ (рабочие папки для фич)

Для каждой новой фичи создавай папку:

```
work/YYYY-MM-DD--feature-name/
├── prd.md          # PRD фичи
├── plan.md         # План реализации
└── tasks/          # Задачи
    ├── task-001.md
    └── task-002.md
```

**Формат названия папки**: `YYYY-MM-DD--краткое-название` (например: `2025-01-15--user-auth`)

### Завершённые фичи

Перед удалением папки фичи после мёржа — **спроси у пользователя**.

## DECISIONS.md

В файле `DECISIONS.md` храни лог важных архитектурных и технических решений.

**Формат записи:**

```markdown
## YYYY-MM-DD: Краткое название решения

**Контекст**: Почему возникла необходимость принять решение

**Решение**: Что решили делать

**Альтернативы**: Какие варианты рассматривали и почему отклонили

**Последствия**: К чему это приведёт (плюсы/минусы)
```

**Автоматически добавляй запись** когда:
- Выбран архитектурный паттерн
- Выбрана библиотека/фреймворк из нескольких вариантов
- Принято решение о структуре проекта
- Изменён подход к тестированию/деплою

## Принципы разработки

- **KISS** (Keep It Simple, Stupid) - простота превыше всего
- **DRY** (Don't Repeat Yourself) - избегай дублирования
- **YAGNI** (You Aren't Gonna Need It) - не добавляй функциональность "на будущее"
- **TDD** - всегда пиши тесты перед кодом

## Workflow для новой фичи

1. **Brainstorming**: ИИ задаёт вопросы, исследует тему, уточняет требования
2. **PRD**: создаётся в `work/YYYY-MM-DD--feature/prd.md`
3. **План**: детализированный план в `work/YYYY-MM-DD--feature/plan.md`
4. **Апрув**: пользователь утверждает ПРД и план
5. **Реализация**: по одной задаче, каждый раз TDD, каждый раз спрашивать перед следующей задачей
6. **Автообновление**: guides обновляются автоматически

## Агенты

Специализированные агенты в `.claude/agents/`:

- `code-developer.md` - разработка + TDD
- `code-reviewer.md` - code review
- `security-auditor.md` - OWASP аудит
- `secret-scanner.md` - проверка секретов перед коммитом

**Используй агентов** для соответствующих задач.

## Команды

Быстрые команды в `.claude/commands/`:

- `/init-project` - инициализация проекта (интервью)
- `/brainstorm` - brainstorming для фичи
- `/dev` - запустить разработчика на задачу
- `/review` - code review
- `/plan` - создать план реализации
- `/test` - запустить тесты
- `/audit` - security audit
- `/secrets` - проверка на секреты перед коммитом
- `/update-guides` - обновить guides вручную

## Если что-то неясно

**Задай вопросы и дождись ответа пользователя.**

Никогда не придумывай, не предполагай, не используй информацию из других проектов.
